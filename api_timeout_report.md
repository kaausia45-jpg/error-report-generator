[api_timeout_report.md](https://github.com/user-attachments/files/24230302/api_timeout_report.md)
※ 본 문서는 자동 생성된 초기 분석 초안입니다.

# [장애 보고서] 외부 결제 API 타임아웃으로 인한 결제 실패

## 1. 개요

- **장애 발생 일시**: 2023년 10월 27일 15:10 ~ 16:30 (총 80분)
- **장애 요약**: 외부 결제 연동 시스템 'PG-Pay'의 응답 지연으로 인해 API 호출 타임아웃이 발생하여, 다수의 결제 요청이 실패 처리되었습니다.
- **담당 부서/담당자**: 플랫폼개발팀 / 홍길동

---

## 2. 타임라인 (KST) <!-- 로그 기반으로 자동 생성되었으며, 관련자 검토가 필요합니다. -->

- **15:10**: 모니터링 시스템(Datadog)에서 결제 실패율(Payment Failure Rate) 급증 알림 발생 (임계치 5% 초과)
- **15:12**: 운영팀, 장애 상황 인지 후 개발팀에 긴급 상황 전파
- **15:15**: 개발팀, 관련 서비스 로그 분석 착수. PG-Pay API 호출에서 `ReadTimeoutException`이 집중적으로 발생하는 것을 확인
- **15:30**: 외부 API(PG-Pay)의 응답 지연을 장애의 직접적인 원인으로 잠정 결론 내리고, PG-Pay 기술 지원 채널을 통해 긴급 문의 접수
- **15:45**: PG-Pay 측으로부터 내부 네트워크 이슈로 인한 응답 지연 사실을 확인받고, 복구 작업이 진행 중임을 통보받음
- **16:20**: PG-Pay 측, 복구 완료 통보. 내부 모니터링 대시보드에서 결제 관련 지표(성공률, API 응답 시간)가 안정화되는 것을 확인
- **16:30**: 서비스 완전 정상화 판단 후 상황 종료 및 보고서 작성 시작

---

## 3. 근본 원인 분석 (Root Cause Analysis)

이번 장애의 근본 원인은 **외부 의존성을 가진 PG-Pay 결제 시스템의 내부 장애**에 있었습니다.

우리 시스템은 PG-Pay 결제 API 호출 시, 안정적인 서비스 운영을 위해 `Connection Timeout`을 5초, `Read Timeout`을 10초로 설정하고 있습니다.

장애 발생 시점, PG-Pay 내부 네트워크 장비의 부하가 증가하여 API 평균 응답 시간이 10초를 초과하기 시작했습니다. 이로 인해 우리 시스템의 API 클라이언트는 정상적으로 응답을 수신하지 못하고 설정된 `Read Timeout`에 도달하여 예외(Exception)를 발생시켰고, 해당 결제 트랜잭션은 모두 실패로 처리되었습니다.

결과적으로 외부 시스템의 성능 저하가 우리 서비스의 핵심 기능인 '결제'에 직접적인 영향을 미친 사례입니다.

---

## 4. 영향 범위 분석 (Impact Analysis)

### 가. 시스템 영향
- 장애 시간 동안 'PG-Pay'를 이용한 **전체 결제 시도의 약 80%가 실패**했습니다.
- 실패한 요청은 사용자에게 '일시적인 오류가 발생했습니다. 잠시 후 다시 시도해주세요.' 메시지를 노출했습니다.
- 타 결제수단(예: 가상계좌, 무통장입금)은 정상 동작했습니다.

### 나. 비즈니스 영향
- **직접적인 매출 손실**: 장애 시간(80분) 동안 발생한 결제 실패 건수는 약 5,000건으로, 이로 인한 직접적인 매출 손실은 **약 2억 원으로 추정**됩니다. (객단가 및 결제 이탈률 고려) <!--※ 재무팀과 최종 검토 후 확정 필요-->
- **고객 경험(CX) 저하**: 많은 고객이 결제 최종 단계에서 반복적인 실패를 경험하며 큰 불편을 겪었습니다. 이로 인해 CS 채널로 **약 350건의 관련 문의가 인입**되었습니다. <!--※ CS팀 데이터 기반, 최종 집계 필요-->
- **브랜드 신뢰도 하락**: 특히, 특정 상품에 대한 타임딜 프로모션이 진행 중인 시간에 장애가 발생하여 소셜 미디어 및 커뮤니티를 중심으로 부정적인 여론이 일부 확산되었습니다. 이는 잠재 고객의 이탈로 이어질 수 있는 위험 요소입니다.

---

## 5. 해결 및 복구 과정

- **해결 조치**: 외부 시스템인 PG-Pay 측에서 부하가 발생한 네트워크 장비를 증설하고 관련 설정을 최적화하여 문제를 해결했습니다.
- **복구 확인**:
    - PG-Pay의 조치 완료 통보 이후, 내부 모니터링 시스템을 통해 결제 성공률과 API 응답 시간이 즉시 정상 수치로 회복된 것을 확인했습니다.
    - 장애 시간 동안 결제에 실패한 고객들을 대상으로, 재결제를 유도하는 알림톡을 발송하여 이탈을 최소화하고자 노력했습니다.

---

## 6. 재발 방지 및 개선 대책 (Action Items)

| 구분 | 대책 내용 | 담당자/부서 | 완료 기한 (예상) |
| :--: | :--- | :---: | :---: |
| 단기 | **1. 서킷 브레이커(Circuit Breaker) 패턴 적용**<br/>- 특정 외부 API의 연속 실패율이 임계치를 초과할 경우, API 호출을 일시적으로 차단(Open)하고 사용자에게 즉시 대체 결제 수단을 안내하는 로직을 추가하여 장애 전파를 방지 | 플랫폼개발팀 | 2023-11-10 |
| 단기 | **2. 외부 API별 Timeout 설정 세분화**<br/>- 각 외부 API의 SLA(서비스 수준 협약) 및 특성을 분석하여 Timeout 값을 보다 정교하게 재조정하고, 관련 문서를 최신화 | 플랫폼개발팀 | 2023-11-17 |
| 중장기 | **3. 결제 PG(Payment Gateway) 시스템 이중화**<br/>- 단일 PG사에 대한 의존도를 낮추기 위해, 제2의 PG사를 도입. 주 PG사 장애 발생 시 트래픽을 부 PG사로 신속하게 전환할 수 있는 시스템을 구축 | 플랫폼개발팀/기획팀 | 2024-Q1 |
| 중장기 | **4. 외부 서비스 상태 모니터링 강화**<br/>- 주요 외부 API(결제, 인증 등)의 상태를 독립적으로 확인할 수 있는 Health Check 로직을 구현하고, 주기적으로 상태를 점검하여 문제 발생 시 선제적으로 대응할 수 있는 체계 마련 | 플랫폼개발팀 | 2023-12-29 |

<!-- ※ 상기 대책 및 일정은 초기 제안으로, 관련 부서와 논의 후 최종 확정될 예정입니다. -->
